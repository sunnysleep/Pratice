#include<reg52.h>
#include"lcd.h"
#define nchar unsigned char
#define uint unsigned int

sbit PWM=P3^5;
sbit key1=P3^1;
sbit key2=P3^0;
sbit key3=P3^2;

uint T;
uint count;
void delay(uint xms)
{
	uint j,k;
	for(j=xms;j>0;j--)
		for(k=125;k>0;k--);
}
void Init()
{
	TMOD=0x01;			  //¶¨Ê±Æ÷0£¬¹¤×÷·½Ê½1
	TH0=0xff;
	TL0=0x06;			 //12MHZÊ± 250us --> 0.25ms
	EA=1;
	ET0=1;
	TR0=1;
}
void KeyScan()
{
	if(key1==0)
	{
		delay(10);
		if(key1==0)
		{
				T=1;		  //´ÓT=1Ê±¼ÆÊý£¬¼ÆÊý10´Î£¬Ê¹PWM²¨Âú×ã2.5ms
				while(key1==1);
		}
	}
	if(key2==0)
	{
		delay(10);
		if(key2==0)
		{
			T=9;			  //´ÓT=9¼ÆÊý£¬¼ÆÊý2´Î£¬Âú×ãPWM²¨Îª0.5ms
			while(key2==1);
				
		}
	}
	if(key3==0)
	{
		delay(10);
		if(key3==0)
		{
			T=6;
			while(key3==1);				
		}
	}

}
void main()
{
	Init();
	while(1)
	{
		KeyScan();
	}
}
void Timer0()interrupt 1
{
	TH0=0xff;
	TL0=0x06;
	T++;				  //Ã¿µ±¼ÆÊý0.25msÊ±T+1
	if(T<=10)			  //0.25ms*10=2.5ms  -->  2.5msÄÚÎª¸ßµçÆ½
	{
		PWM=1;	
	}
	else if(T>10&&T<80000)		  //ÆäÓàÎªµÍµçÆ½  -->  ×ÜÊ±³¤0.25ms*80000=20ms
	{PWM=0;}
	else if(T==80000)		  //¼ÆÂúºóÇåÁã£¬±£Ö¤ÖÜÆÚÎª20ms
	T=0;
}
